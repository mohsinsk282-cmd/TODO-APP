# Developer Quickstart Guide

**Feature**: `004-frontend-nextjs-better-auth`
**Date**: 2026-01-16
**Phase**: 1 (Design Artifacts)

## Overview

This guide helps developers set up and start working on the Next.js 16 todo frontend with Better Auth authentication. Follow these steps to get the development environment running and understand the project structure.

---

## Prerequisites

Before starting, ensure you have:

- **Node.js 18+** (LTS recommended)
- **npm 9+** or **yarn 1.22+** or **pnpm 8+**
- **Git** for version control
- **PostgreSQL** (Neon or local) with database credentials
- **FastAPI backend** running at `http://localhost:8000` (from Phase I)

**Verify Prerequisites**:
```bash
node --version  # Should show v18.x.x or higher
npm --version   # Should show 9.x.x or higher
git --version   # Should show 2.x.x or higher
```

---

## Step 1: Clone and Navigate to Project

```bash
# If not already in the project directory
cd /path/to/TODO-APP

# Checkout the feature branch
git checkout 004-frontend-nextjs-better-auth

# Navigate to frontend directory (will be created during implementation)
cd frontend
```

---

## Step 2: Install Dependencies

```bash
# Using npm (recommended)
npm install

# OR using yarn
yarn install

# OR using pnpm
pnpm install
```

**Expected Installation Time**: 1-2 minutes

**Dependencies** (automatically installed):
- `next@16.1.1` - React framework with App Router
- `react@19` - React library
- `react-dom@19` - React DOM rendering
- `typescript@5+` - TypeScript compiler
- `tailwindcss@3+` - Utility-first CSS framework
- `better-auth@1.3.4` - Authentication library
- `@better-auth/react` - Better Auth React hooks

---

## Step 3: Environment Configuration

Create a `.env.local` file in the `frontend/` directory:

```bash
# Create .env.local
touch .env.local
```

**Add the following environment variables**:

```bash
# =============================================================================
# Next.js Configuration
# =============================================================================

# Public URL (development)
NEXT_PUBLIC_APP_URL=http://localhost:3000

# Backend API base URL
NEXT_PUBLIC_API_URL=http://localhost:8000

# =============================================================================
# Better Auth Configuration
# =============================================================================

# Better Auth secret (MUST match backend secret)
BETTER_AUTH_SECRET=65lt50IQDVae5K7bbtuRrlkod9h9uSuq

# Better Auth database URL (Neon PostgreSQL or local)
# Option 1: Use same Neon database as backend
DATABASE_URL=postgresql://user:password@host.neon.tech/todoapp?sslmode=require

# Option 2: Use separate auth database (recommended for production)
# DATABASE_URL=postgresql://user:password@host.neon.tech/todoapp_auth?sslmode=require

# Better Auth session settings
BETTER_AUTH_SESSION_MAX_AGE=604800  # 7 days in seconds
BETTER_AUTH_SESSION_UPDATE_AGE=86400  # Refresh session every 24 hours

# =============================================================================
# Optional: Feature Flags
# =============================================================================

# Enable development tools (hot reload, verbose logging)
NEXT_PUBLIC_DEV_MODE=true

# Enable verbose API logging
NEXT_PUBLIC_API_DEBUG=false
```

**Critical Configuration Notes**:

1. **BETTER_AUTH_SECRET**: MUST be identical to the backend's `BETTER_AUTH_SECRET` in `backend/.env`. This ensures JWT tokens generated by Better Auth can be verified by the FastAPI backend.

2. **DATABASE_URL**: Can point to:
   - Same Neon database as backend (simpler, single database)
   - Separate auth database (recommended for production, isolates auth data)

3. **NEXT_PUBLIC_* Variables**: Exposed to browser (safe for public URLs only, no secrets!)

---

## Step 4: Start Development Server

```bash
# Start Next.js dev server
npm run dev

# OR
yarn dev

# OR
pnpm dev
```

**Expected Output**:
```
 â–² Next.js 16.1.1
 - Local:        http://localhost:3000
 - Network:      http://192.168.1.100:3000

 âœ“ Ready in 2.3s
```

**Open in Browser**: `http://localhost:3000`

---

## Step 5: Verify Backend Connection

Before developing frontend features, ensure the FastAPI backend is running:

```bash
# In a separate terminal, navigate to backend directory
cd ../backend

# Start FastAPI backend
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

**Verify Backend**:
```bash
# Test health check
curl http://localhost:8000/

# Expected response:
# {"message": "Todo API is running", "version": "1.0.0"}
```

**Swagger UI**: Open `http://localhost:8000/docs` to test backend endpoints.

---

## Project Structure Overview

Once implementation begins, the frontend structure will look like this:

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router (pages, layouts)
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # Root layout with providers
â”‚   â”‚   â”œâ”€â”€ page.tsx          # Landing page (/)
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # Login page
â”‚   â”‚   â”œâ”€â”€ signup/
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx      # Signup page
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”‚       â””â”€â”€ page.tsx      # Dashboard (protected route)
â”‚   â”‚
â”‚   â”œâ”€â”€ components/           # React components
â”‚   â”‚   â”œâ”€â”€ ui/               # Reusable UI components (Button, Input, etc.)
â”‚   â”‚   â”œâ”€â”€ auth/             # Auth-related components (LoginForm, SignupForm)
â”‚   â”‚   â”œâ”€â”€ tasks/            # Task components (TaskList, TaskItem, TaskForm)
â”‚   â”‚   â””â”€â”€ layout/           # Layout components (Header, Footer, Sidebar)
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                  # Utility libraries
â”‚   â”‚   â”œâ”€â”€ auth.ts           # Better Auth client configuration
â”‚   â”‚   â”œâ”€â”€ api-client.ts     # API client for backend communication
â”‚   â”‚   â”œâ”€â”€ error-handler.ts  # Centralized error handling
â”‚   â”‚   â””â”€â”€ validation.ts     # Form validation rules
â”‚   â”‚
â”‚   â”œâ”€â”€ contexts/             # React Context providers
â”‚   â”‚   â”œâ”€â”€ ThemeContext.tsx  # Dark/light mode state
â”‚   â”‚   â””â”€â”€ ToastContext.tsx  # Toast notification state
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                # Custom React hooks
â”‚   â”‚   â”œâ”€â”€ useAuth.ts        # Authentication hook
â”‚   â”‚   â”œâ”€â”€ useTasks.ts       # Task CRUD operations hook
â”‚   â”‚   â””â”€â”€ useToast.ts       # Toast notification hook
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                # TypeScript type definitions
â”‚   â”‚   â”œâ”€â”€ index.ts          # Central type exports
â”‚   â”‚   â”œâ”€â”€ user.ts           # User and auth types
â”‚   â”‚   â”œâ”€â”€ task.ts           # Task types
â”‚   â”‚   â”œâ”€â”€ api.ts            # API request/response types
â”‚   â”‚   â””â”€â”€ form.ts           # Form state types
â”‚   â”‚
â”‚   â””â”€â”€ middleware.ts         # Next.js middleware (route protection)
â”‚
â”œâ”€â”€ public/                   # Static assets
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ images/
â”‚
â”œâ”€â”€ .env.local                # Environment variables (gitignored)
â”œâ”€â”€ next.config.js            # Next.js configuration
â”œâ”€â”€ tailwind.config.js        # Tailwind CSS configuration
â”œâ”€â”€ tsconfig.json             # TypeScript configuration
â””â”€â”€ package.json              # Dependencies and scripts
```

---

## Key Files and Their Purpose

### 1. `src/app/layout.tsx` (Root Layout)

**Purpose**: Wraps entire app with providers (theme, toast, auth)

**Key Features**:
- Better Auth session provider
- Theme provider (dark/light mode)
- Toast notification provider
- Global styles and fonts

**Usage**: All pages inherit this layout automatically.

---

### 2. `src/lib/auth.ts` (Better Auth Client)

**Purpose**: Configures Better Auth for Next.js

**Key Features**:
- JWT token generation
- Session management
- Signup/signin/signout methods
- HTTP-only cookie storage

**Usage**: Import `authClient` in components that need authentication.

---

### 3. `src/lib/api-client.ts` (Backend API Client)

**Purpose**: Centralized client for all backend API requests

**Key Features**:
- Automatic JWT token inclusion in `Authorization` header
- Centralized error handling (401, 403, 404, 5xx)
- Retry logic for network/server errors
- Type-safe request/response handling

**Usage**: Import `apiClient` in hooks that fetch/mutate data.

---

### 4. `src/middleware.ts` (Route Protection)

**Purpose**: First line of defense for protected routes

**Key Features**:
- Checks for session cookie before page render
- Redirects unauthenticated users to `/login`
- Fast redirects (no page render for unauthorized users)

**Usage**: Automatically runs on all routes matching `/dashboard/*`.

---

### 5. `src/hooks/useTasks.ts` (Task CRUD Hook)

**Purpose**: Provides task state and CRUD operations

**Key Features**:
- `fetchTasks()` - Load all tasks
- `createTask(data)` - Create new task
- `updateTask(id, data)` - Update existing task
- `deleteTask(id)` - Delete task
- `toggleTaskCompletion(id)` - Toggle completion status
- `setFilter(status)` - Filter by all/pending/completed

**Usage**: Call `const { tasks, createTask, ... } = useTasks()` in components.

---

### 6. `src/hooks/useAuth.ts` (Authentication Hook)

**Purpose**: Provides auth state and actions

**Key Features**:
- `user` - Current user object (or `null`)
- `isAuthenticated` - Boolean auth status
- `signIn(email, password)` - Login action
- `signUp(email, password)` - Signup action
- `signOut()` - Logout action

**Usage**: Call `const { user, signIn, signOut, ... } = useAuth()` in components.

---

## Development Workflow

### 1. Feature Development Process

Follow this workflow for implementing user stories (P1-P8):

```bash
# 1. Ensure on feature branch
git checkout 004-frontend-nextjs-better-auth

# 2. Pull latest changes
git pull origin 004-frontend-nextjs-better-auth

# 3. Create a new task branch (optional, for parallel work)
git checkout -b task/implement-user-authentication

# 4. Implement the feature (code, test, document)

# 5. Test locally (run dev server, manual testing)
npm run dev

# 6. Run type checks
npm run type-check

# 7. Run linter
npm run lint

# 8. Commit changes
git add .
git commit -m "feat: implement user authentication (P1)

- Add Better Auth configuration
- Create login/signup pages
- Implement useAuth hook
- Add route protection middleware

ðŸ¤– Generated with Claude Code"

# 9. Push to remote
git push origin task/implement-user-authentication

# 10. Create PR (if using task branches) or continue on feature branch
```

---

### 2. Testing Strategy

**Manual Testing**:
```bash
# Start dev server
npm run dev

# Open browser to test flows:
# 1. http://localhost:3000 (landing page)
# 2. http://localhost:3000/signup (create account)
# 3. http://localhost:3000/login (sign in)
# 4. http://localhost:3000/dashboard (view tasks)
# 5. Test CRUD operations (create, update, delete, toggle tasks)
# 6. Toggle dark/light mode
# 7. Test error handling (invalid input, network errors)
```

**Type Checking**:
```bash
# Run TypeScript compiler
npm run type-check

# Expected output:
# âœ“ Type checking complete (0 errors)
```

**Linting**:
```bash
# Run ESLint
npm run lint

# Auto-fix issues
npm run lint:fix
```

**Build Test** (before committing):
```bash
# Test production build
npm run build

# Expected output:
# âœ“ Compiled successfully
# âœ“ Linting and type checking complete
```

---

### 3. Common Development Tasks

**Add a New Component**:
```bash
# Create component file
touch src/components/ui/Button.tsx

# Add TypeScript types
# Define props interface
# Implement component
# Export from index (if using barrel exports)
```

**Add a New Page**:
```bash
# Create page directory
mkdir src/app/new-page

# Create page file
touch src/app/new-page/page.tsx

# Next.js automatically routes to /new-page
```

**Add a Custom Hook**:
```bash
# Create hook file
touch src/hooks/useCustomHook.ts

# Implement hook with TypeScript types
# Export hook
# Use in components
```

**Update API Client**:
```bash
# Edit API client types
vim src/types/api.ts

# Edit API client implementation
vim src/lib/api-client.ts

# Test with backend
curl http://localhost:8000/api/test_user_123/tasks \
  -H "Authorization: Bearer {token}"
```

---

## Environment Variables Reference

| Variable | Purpose | Required | Default | Example |
|----------|---------|----------|---------|---------|
| `NEXT_PUBLIC_APP_URL` | Frontend base URL | Yes | - | `http://localhost:3000` |
| `NEXT_PUBLIC_API_URL` | Backend API URL | Yes | - | `http://localhost:8000` |
| `BETTER_AUTH_SECRET` | JWT signing secret | Yes | - | `65lt50IQDVae5K7bbtuRrlkod9h9uSuq` |
| `DATABASE_URL` | PostgreSQL connection string | Yes | - | `postgresql://user:pass@host/db` |
| `BETTER_AUTH_SESSION_MAX_AGE` | Session duration (seconds) | No | 604800 | `604800` (7 days) |
| `NEXT_PUBLIC_DEV_MODE` | Enable dev tools | No | false | `true` |
| `NEXT_PUBLIC_API_DEBUG` | Enable API logging | No | false | `false` |

---

## Troubleshooting

### Issue 1: Backend Connection Refused

**Error**: `ECONNREFUSED 127.0.0.1:8000`

**Solution**:
```bash
# Verify backend is running
curl http://localhost:8000/

# If not running, start backend:
cd backend
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

---

### Issue 2: JWT Verification Failure

**Error**: `401 Unauthorized` on all API requests

**Cause**: `BETTER_AUTH_SECRET` mismatch between frontend and backend

**Solution**:
```bash
# Verify secrets match:
# Frontend: frontend/.env.local
# Backend: backend/.env

# Both should have:
BETTER_AUTH_SECRET=65lt50IQDVae5K7bbtuRrlkod9h9uSuq
```

---

### Issue 3: Session Not Persisting

**Error**: User gets logged out on page refresh

**Cause**: HTTP-only cookie not being sent/received

**Solution**:
```bash
# 1. Ensure using localhost (not 127.0.0.1)
# Cookies may not work across domain mismatches

# 2. Check browser DevTools > Application > Cookies
# Should see better-auth-session cookie with HttpOnly flag

# 3. Clear browser cookies and try again
# Sometimes stale cookies cause issues
```

---

### Issue 4: Type Errors

**Error**: TypeScript errors on import statements

**Solution**:
```bash
# Ensure types are exported from central index
# Check src/types/index.ts

# Re-run type check
npm run type-check

# Restart TypeScript server in IDE
# VSCode: Cmd+Shift+P â†’ "TypeScript: Restart TS Server"
```

---

### Issue 5: Dark Mode Not Working

**Error**: Theme toggle doesn't persist across pages

**Cause**: Theme state not persisted to localStorage

**Solution**:
```typescript
// Check ThemeContext implementation
// Ensure useEffect saves to localStorage:
useEffect(() => {
  localStorage.setItem('theme', theme);
  document.documentElement.classList.toggle('dark', theme === 'dark');
}, [theme]);
```

---

## Next Steps

Once development environment is set up:

1. **Read Architecture Plan**: Review [`specs/004-frontend-nextjs-better-auth/plan.md`](./plan.md)
2. **Review Research Findings**: Read [`specs/004-frontend-nextjs-better-auth/research.md`](./research.md)
3. **Understand Data Model**: Study [`specs/004-frontend-nextjs-better-auth/data-model.md`](./data-model.md)
4. **Review API Contracts**: Check [`specs/004-frontend-nextjs-better-auth/contracts/`](./contracts/)
5. **Implement by Priority**: Follow task breakdown from `/sp.tasks` (P1 â†’ P2 â†’ ... â†’ P8)

---

## Helpful Resources

### Documentation

- **Next.js 16 Docs**: https://nextjs.org/docs
- **Better Auth Docs**: https://better-auth.com/docs
- **Tailwind CSS Docs**: https://tailwindcss.com/docs
- **React 19 Docs**: https://react.dev/

### Internal Docs

- **Backend API**: [`backend/API_TESTING_GUIDE.md`](../../backend/API_TESTING_GUIDE.md)
- **Project Constitution**: [`.specify/memory/constitution.md`](../../.specify/memory/constitution.md)
- **Feature Spec**: [`specs/004-frontend-nextjs-better-auth/spec.md`](./spec.md)

### Tools

- **Swagger UI** (Backend): http://localhost:8000/docs
- **React DevTools**: https://react.dev/learn/react-developer-tools
- **TypeScript Playground**: https://www.typescriptlang.org/play

---

## Questions or Issues?

If you encounter problems not covered in this guide:

1. **Check PHRs**: Review Prompt History Records in `history/prompts/frontend-nextjs-better-auth/` for past decisions
2. **Check ADRs**: Review Architecture Decision Records in `history/adr/` for architectural rationale
3. **Ask the Team**: Post in team chat or create a GitHub issue
4. **Update This Guide**: If you solve a new issue, add it to the Troubleshooting section

---

**Document Version**: 1.0
**Last Updated**: 2026-01-16
**Maintainer**: Development Team
**Feedback**: Open a PR to improve this guide
